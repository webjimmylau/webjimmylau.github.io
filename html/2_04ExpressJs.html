<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link rel="stylesheet" href="../css/base.css"/>
    <link rel="stylesheet" href="../css/common.css"/>
    <script src="../js/jquery.min.js"></script>
    <script src="../js/scrollTopControl.js"></script>
    <script src="../js/common.js"></script>
</head>
<body>
<div class="head"></div>
<div class="subMenu">
    <div class="wrap">
        <div class="subTitle">NodeJs专区：</div>
        <ul>
            <li><a href="#01" class="click">ExpressJs简介</a></li>
            <li><a href="#02">ExpressJs用法</a></li>
        </ul>
    </div>
</div>
<div class="container fn-clear">
    <div class="wrap">
        <div class="contBox">
            <i id="01" class="anchor"></i>
            <h4>ExpressJs简介</h4>
            <p>Express.js 是一个基于 Node.js 平台的极简、灵活的 web 应用开发框架，它提供一系列强大的特性，帮助你创建各种 Web 和移动设备应用。</p>
            <p>Express.js 丰富的 HTTP 快捷方法和任意排列组合的 Connect 中间件，让你创建健壮、友好的 API 变得既快速又简单。</p>
            <p>Express.js 不对 Node.js 已有的特性进行二次抽象，我们只是在它之上扩展了 Web 应用所需的基本功能。</p>
        </div>
        <div class="contBox">
            <i id="02" class="anchor"></i>
            <h4>ExpressJs用法</h4>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>express 组织结构</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>app demo</td>
                    <td>
                        <p>本地模块-----------------------|- node_modules</p>
                        <p>静态文件-----------------------|- public</p>
                        <p>路由文件-----------------------|- routes</p>
                        <p>网页模板-----------------------|- views</p>
                        <p>启动脚本-----------------------|- app.js</p>
                        <p>配置文件-----------------------|- package.json</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>启动脚本 package.json</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>package.json</td>
                    <td>用于指定app信息，nodejs版本号和其他组件的依赖关系</td>
                </tr>
                <tr>
                    <td>具体内容</td>
                    <td>
                        <p>{</p>
                        <p>&nbsp;&nbsp;"name": "demo",</p>
                        <p>&nbsp;&nbsp;"description": "My First Express App",</p>
                        <p>&nbsp;&nbsp;"version": "0.0.1",</p>
                        <p>&nbsp;&nbsp;"dependencies": {</p>
                        <p>&nbsp;&nbsp;&nbsp;&nbsp;"express": "3.x"</p>
                        <p>&nbsp;&nbsp;}</p>
                        <p>}</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>创建 express 服务器</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>创建app</td>
                    <td>
                        <p>var express = require('express');</p>
                        <p>var app = express();</p>
                    </td>
                </tr>
                <tr>
                    <td>指定更目录显示的内容</td>
                    <td>
                        <p>app.get('/', function(req, res){</p>
                        <p>&nbsp;&nbsp;res.send('Hello World');</p>
                        <p>});</p>
                    </td>
                </tr>
                <tr>
                    <td>指定监听端口</td>
                    <td>
                       <p>var server = app.listen(3000, function() {</p>
                       <p>&nbsp;&nbsp;console.log('Listening on port %d', server.address().port);</p>
                       <p>});</p>
                    </td>
                </tr>
                <tr>
                    <td>运行nodejs应用程序</td>
                    <td>node app.js</td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>路由</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>express路由常用的几种方式</td>
                    <td>
                        <p>app.use('/', middleware); // get/post时，对于路径/的处理</p>
                        <p>app.get("/", middleware); // http中get时，对于路径/的处理</p>
                        <p>app.post("/", middleware); // http中post时，对于路径/的处理</p>
                        <p>app.put("/", middleware); // http中put时，对于路径/的处理</p>
                        <p>app.delete("/", middleware); // http中delete时，对于路径/的处理</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>use 中间件</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>use</td>
                    <td>就是express调用中间件的方法，它返回一个函数</td>
                </tr>
                <tr>
                    <td>使用方法</td>
                    <td>
                        <p>app.use(function(request, response) {</p>
                        <p>&nbsp;&nbsp;response.writeHead(200, { "Content-Type": "text/plain" });</p>
                        <p>&nbsp;&nbsp;response.end("Hello world!\n");</p>
                        <p>});</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>middleware 中间件</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>middleware</td>
                    <td>就是处理HTTP请求的函数，包含四个参数：错误处理、客户请求、服务器响应、next中间件</td>
                </tr>
                <tr>
                    <td>四个的时候</td>
                    <td>function(error, request, response, next){ }</td>
                </tr>
                <tr>
                    <td>三个的时候</td>
                    <td>function(request, response, next){ }</td>
                </tr>
                <tr>
                    <td>两个的时候</td>
                    <td>function(request, response){ }</td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>requst对象方法</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>获取客户ip地址</td>
                    <td>request.ip</td>
                </tr>
                <tr>
                    <td>获取上传的文件</td>
                    <td>request.files</td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>response对象方法</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>重定向redirect</td>
                    <td>response.redirect("/hello/anime"); // 重定向到/hello/anime</td>
                </tr>
                <tr>
                    <td>发送文件sendFile</td>
                    <td>response.sendFile("/path/to/anime.mp4"); // 发送anime.mp4文件</td>
                </tr>
                <tr>
                    <td>渲染网页模板render</td>
                    <td>response.render("index", { message: "Hello World" }); // 将message变量传入index模板，值为"Hello World"渲染成HTML网页</td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>路径通配符</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>*表示所有路径</td>
                    <td>
                        <p>app.get("*", function(request, response) {</p>
                        <p>&nbsp;&nbsp;response.end("404!");</p>
                        <p>}); // 所有路径都返回404</p>
                    </td>
                </tr>
                <tr>
                    <td>:表示捕获路径内容</td>
                    <td>
                        <p>app.get("/hello/:who", function(req, res) {</p>
                        <p>&nbsp;&nbsp;res.end("Hello, " + req.params.who + ".");</p>
                        <p>});//如"/hello/alice”网址，网址中的alice将被捕获，作为req.params.who属性的值</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>设置环境变量set</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>set用于指定变量的值</td>
                    <td>app.set("view engine", "ejs"); // 使用ejs作为模版</td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>动态网页模板 views</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>views文件夹，存放所有的放网页模板</td>
                    <td>
                        <p>app.set("views", "/views"); // 模板引擎目录</p>
                        <p>app.set("view engine", "ejs"); // 指定模板引擎</p>
                    </td>
                </tr>
                <tr>
                    <td>使用方法</td>
                    <td>
                        <p>// app.js</p>
                        <p>app.get('/', function(req, res) {</p>
                        <p>&nbsp;&nbsp;res.render('index',{title:"最近文章"});</p>
                        <p>});</p>
                        <p>&nbsp;</p>
                        <p>// /views/index.js</p>
                        <p>this is <%=title%>!</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>指定静态网页目录 public</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>public文件夹，存放静态文件</td>
                    <td>app.use(express.static('public'));</td>
                </tr>
                <tr>
                    <td>用途</td>
                    <td>
                        <p>指定静态网页目录,当浏览器发出非HTML文件请求时，服务器端就到public目录寻找这个文件</p>
                        <p>如：link href="/bootstrap/css/bootstrap.css", 服务器端就到 public/bootstrap/css/目录中寻找bootstrap.css文件</p>
                    </td>
                </tr>
            </table>
            <table class="tableNo1">
                <tr>
                    <th colspan="2"><b>错误内容显示</b></th>
                </tr>
                <tr>
                    <td width="25%"><b>代码</b></td>
                    <td><b>描述</b></td>
                </tr>
                <tr>
                    <td>使用方法</td>
                    <td>
                        <p>app.use(express.bodyParser()); // 使用body参数</p>
                        <p>app.use(express.methodOverride()); // 使用函数覆盖</p>
                        <p>app.use(app.router); // 使用路由</p>
                        <p>app.use(function(err, req, res, next){</p>
                        <p>&nbsp;&nbsp;console.error(err.stack);</p>
                        <p>&nbsp;&nbsp;res.send(500, 'Something broke!');</p>
                        <p>}); // 错误内容显示</p>
                    </td>
                </tr>
            </table>
        </div>
    </div>
</div>
<div class="foot"></div>
</body>
</html>